<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js Annotations - HTML Export (JSON Fix)</title>
 
	<link rel="stylesheet" href="css/controlKit.css"> <!-- Adjust path if needed -->
    <link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.3.1/css/ion.rangeSlider.min.css"/>

    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; background-color: #1a1a1a; color: #fff; }
        .controlKit { z-index: 1000 !important; }
        #info { position: absolute; top: 10px; width: 100%; text-align: center; z-index: 1; pointer-events: none; color: #ccc; font-size: 0.9em; }
        #three-canvas { display: block; width: 100vw; height: 100vh; cursor: default; }
        #annotation-popup { visibility: hidden; opacity: 0; position: absolute; background-color: rgba(40, 40, 40, 0.9); border: 1px solid #666; border-radius: 5px; padding: 10px 15px; padding-bottom: 35px; color: #eee; max-width: 250px; min-width: 180px; z-index: 1001; pointer-events: auto; box-shadow: 0 2px 5px rgba(0,0,0,0.3); font-size: 0.9em; line-height: 1.4; -webkit-user-select: none; -ms-user-select: none; user-select: none; transition: opacity 0.2s ease-in-out; }
        #annotation-popup.visible { visibility: visible; opacity: 1; }
        #annotation-popup h4 { margin: 0 0 8px 0; padding-bottom: 5px; border-bottom: 1px solid #555; font-size: 1.1em; color: #00aaff; }
        #annotation-popup p { margin: 0; white-space: pre-wrap; word-wrap: break-word; }
        #popup-close { position: absolute; top: 5px; right: 5px; background: rgba(80, 80, 80, 0.8); color: #fff; border: none; border-radius: 50%; width: 20px; height: 20px; line-height: 18px; text-align: center; font-weight: bold; cursor: pointer; font-size: 14px; padding: 0; z-index: 2; }
        #popup-close:hover { background: rgba(120, 0, 0, 0.9); }
        .popup-nav { position: absolute; bottom: 8px; left: 15px; right: 15px; display: flex; justify-content: space-between; }
        .popup-nav button { background: rgba(80, 80, 80, 0.8); color: #fff; border: 1px solid #aaa; border-radius: 3px; padding: 2px 10px; cursor: pointer; font-size: 1.1em; }
        .popup-nav button:hover:not(:disabled) { background: rgba(100, 100, 100, 0.9); }
        .popup-nav button:disabled { opacity: 0.4; cursor: not-allowed; }
    </style>
	


	<script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"

            }
        }
    </script>

</head>
<body>
    <div id="info">Nhấp đúp để tạo Annotation | Nhấp STT để xem chi tiết & di chuyển camera</div>

    <canvas id="three-canvas"></canvas>

	 <div id="timeline" style="display:none;">
        <div id="timeline-controls">
            <div id="timeline-range-wrap">
                <div id="timeline-range">
                    <input type="text" id="timeline-range-input" name="timeline_range" value="" />
                </div>
            </div>
            <div id="timeline-progress-wrap">
                <div id="timeline-progress">
                    <input type="text" id="timeline-progress-input" name="timeline_progress" value="" />
                </div>
                <div id="timeline-pause-resume"><div class="play-icon"></div><div class="pause-icon"></div></div>
            </div>
        </div>
    </div>
    <!-- Annotation Popup HTML -->
    <div id="annotation-popup">
        <button id="popup-close">X</button>
        <h4 id="popup-name">Annotation Name</h4>
        <p id="popup-note">Annotation details will appear here.</p>
        <div class="popup-nav">
            <button id="popup-prev">< Trước</button>
            <button id="popup-next">Sau ></button>
        </div>
    </div>   
   <!-- panel vật liệu -->
<div id="material-editor-panel" style="
    position: absolute;
    top: 50px;
    left: 15px;
    width: 220px;
    background-color: rgba(34, 34, 34, 0.9);
    border: 1px solid #555;
    border-radius: 6px;
    z-index: 1002;
    display: none;
    color: #ddd;
    font-family: sans-serif;
    font-size: 0.85em;
    box-shadow: 1px 1px 5px rgba(0, 0, 0, 0.2);
">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; padding: 8px 10px; cursor: grab;"> <strong style="font-size: 1em;">Vật Liệu</strong>
        <button onclick="document.getElementById('material-editor-panel').style.display='none'"
            style="background: none; color: #aaa; border: none; font-weight: bold; font-size: 1em; cursor: pointer; opacity: 0.7; transition: opacity 0.2s ease-in-out;"
            onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">×</button>
    </div>
    <hr style="border-color: #555; margin-bottom: 5px;"> <div style="margin-bottom: 6px; padding: 0 10px;"> <label for="material-color" style="display: block; margin-bottom: 2px;">Màu:</label>
        <input type="color" id="material-color" style="width: 100%; border: none; padding: 4px; border-radius: 3px; background-color: #444; color: #eee; cursor: pointer;">
    </div>

    <div style="margin-bottom: 6px; padding: 0 10px;">
        <label for="material-metalness" style="display: block; margin-bottom: 2px;">Kim Loại:</label>
        <input type="range" id="material-metalness" min="0" max="1" step="0.01" style="width: 100%; height: 16px; cursor: pointer;">
    </div>

    <div style="margin-bottom: 6px; padding: 0 10px;">
        <label for="material-roughness" style="display: block; margin-bottom: 2px;">Độ Nhám:</label>
        <input type="range" id="material-roughness" min="0" max="1" step="0.01" style="width: 100%; height: 16px; cursor: pointer;">
    </div>

    <div style="margin-bottom: 6px; padding: 0 10px;">
        <label for="material-opacity" style="display: block; margin-bottom: 2px;">Độ Mờ:</label>
        <input type="range" id="material-opacity" min="0" max="1" step="0.01" style="width: 100%; height: 16px; cursor: pointer;">
    </div>

    <div style="margin-bottom: 6px; padding: 0 10px;">
        <label for="material-emissive" style="display: block; margin-bottom: 2px;">Phát Sáng:</label>
        <input type="color" id="material-emissive" value="#000000" style="width: 100%; border: none; padding: 4px; border-radius: 3px; background-color: #444; color: #eee; cursor: pointer;">
    </div>

    <div style="margin-bottom: 8px; padding: 0 10px;">
        <label for="material-emissive-intensity" style="display: block; margin-bottom: 2px;">Cường Độ:</label>
        <input type="range" id="material-emissive-intensity" min="0" max="10" step="0.1" style="width: 100%; height: 16px; cursor: pointer;">
    </div>

    <div style="padding: 0 10px;">
        <label style="display: flex; align-items: center; font-size: 0.9em;">
            <input type="checkbox" id="material-transparent" style="margin-right: 5px; cursor: pointer;">
            Trong Suốt
        </label>
    </div>

</div>
		<!-- Animation Control Bar -->

    <!-- Hidden file inputs -->
    <input type="file" id="modelFileInput" accept=".gltf,.glb,.obj" style="display: none;">
    <input type="file" id="hdriFileInput" accept=".hdr,.exr" style="display: none;">

    <!-- Dependencies via CDN -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/loaders/RGBELoader.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/automat/controlkit.js@master/bin/controlKit.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.3.1/js/ion.rangeSlider.min.js"></script>

    <script type="module" src="js/main.module.js"></script>
    <script src="js/panelmat_move.js"></script>	

</body>
</html>